(function(){"use strict";var e={6466:function(e,t,a){var o=a(3751),i=a(641);const n={id:"app",class:"d-flex justify-content-center align-items-center vh-100"},r={id:"app"};function s(e,t,a,o,s,l){const d=(0,i.g2)("FileUpload"),c=(0,i.g2)("AnimatedBackground"),p=(0,i.g2)("router-view");return(0,i.uX)(),(0,i.CE)(i.FK,null,[(0,i.Lk)("div",n,[(0,i.bF)(d)]),(0,i.Lk)("div",r,[(0,i.bF)(c),(0,i.bF)(p)])],64)}var l=a.p+"img/loading.a49169fa.gif";const d=e=>((0,i.Qi)("data-v-65c9e75a"),e=e(),(0,i.jt)(),e),c={key:0,class:"loading-overlay"},p=d((()=>(0,i.Lk)("img",{src:l,alt:"Loading..."},null,-1))),g=[p],h={class:"container-fluid h-100"},m=d((()=>(0,i.Lk)("h1",{class:"text-center mb-4"},"AI Convert Tool",-1))),u={class:"row justify-content-center align-items-center h-100"},f={class:"col-md-6"},w={class:"card shadow-sm mb-0"},v={class:"card-body text-center"},I={key:0,class:"uploaded-photo mb-0"},y=["src"],b={class:"form-check form-switch mb-4"},L=d((()=>(0,i.Lk)("label",{class:"form-check-label text-white",for:"aiConvertToggle"},"Use AI Conversion",-1))),k=["disabled"],C=["disabled"],F={class:"col-md-6"},E={class:"card shadow-sm text-center"},U={class:"card-body"},A={class:"frame-preview position-relative mb-4"},P=["src"],_=["src"],R=["disabled"];function O(e,t,a,n,r,s){const l=(0,i.g2)("file-pond");return(0,i.uX)(),(0,i.CE)(i.FK,null,[r.isLoading?((0,i.uX)(),(0,i.CE)("div",c,g)):(0,i.Q3)("",!0),(0,i.Lk)("div",h,[m,(0,i.Lk)("div",u,[(0,i.Lk)("div",f,[(0,i.Lk)("div",w,[(0,i.Lk)("div",v,[(0,i.bo)((0,i.bF)(l,{ref:"pond","allow-multiple":!1,"accepted-file-types":r.acceptedFileTypes,onUpdatefiles:s.handleFileUpdate,class:"mb-4"},null,8,["accepted-file-types","onUpdatefiles"]),[[o.aG,r.showFileInput]]),r.uploadedImage?((0,i.uX)(),(0,i.CE)("div",I,[(0,i.Lk)("img",{src:r.uploadedImage,alt:"Uploaded Photo",ref:"image",class:"img-fluid rounded shadow-sm",onLoad:t[0]||(t[0]=(...e)=>s.initializeCropper&&s.initializeCropper(...e))},null,40,y)])):(0,i.Q3)("",!0),(0,i.Lk)("div",b,[(0,i.bo)((0,i.Lk)("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"aiConvertToggle","onUpdate:modelValue":t[1]||(t[1]=e=>r.useAIConvert=e)},null,512),[[o.lH,r.useAIConvert]]),L]),(0,i.Lk)("button",{onClick:t[2]||(t[2]=e=>{r.isLoading=!0,s.cropImage()}),disabled:!r.uploadedImage||r.isLoading,class:"btn btn-primary"}," Apply ",8,k),(0,i.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>s.cancelCropping&&s.cancelCropping(...e)),disabled:!r.uploadedImage,class:"btn btn-danger ml-2"}," Cancel ",8,C)])])]),(0,i.Lk)("div",F,[(0,i.Lk)("div",E,[(0,i.Lk)("div",U,[(0,i.Lk)("div",A,[r.framedImage?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("img",{key:0,src:r.frameImageSrc,alt:"Cropped Photo",class:"img-fluid rounded shadow-sm"},null,8,P)),r.framedImage?((0,i.uX)(),(0,i.CE)("img",{key:1,src:r.framedImage,alt:"Frame",class:"position-absolute top-0 start-0 w-100 h-100"},null,8,_)):(0,i.Q3)("",!0)]),(0,i.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>s.downloadFramedImage&&s.downloadFramedImage(...e)),disabled:!r.framedImage,class:"btn btn-success"}," Download ",8,R)])])])])])],64)}a(6573),a(8100),a(7936),a(7467),a(4732),a(9577),a(4979),a(4603),a(7566),a(8721);var x=a(9092),j=a.n(x),D=a(3424),S=a.n(D),M=a(5643),T=a.n(M),z=a(4335),B={components:{FilePond:j()(S())},data(){return{uploadedImage:null,croppedImage:null,framedImage:null,editedImage:null,frameImageSrc:a(6637),acceptedFileTypes:["image/jpeg","image/png"],cropper:null,showFileInput:!0,isLoading:!1,faceDetected:!0,isPrompt:!1,useAIConvert:!1}},methods:{async handleFileUpdate(e){if(this.isLoading=!0,e.length>0){const t=e[0].file;this.uploadedImage=await URL.createObjectURL(t),this.showFileInput=!1}else this.resetImages();this.isLoading=!1},cancelCropping(){this.uploadedImage=null,this.croppedImage=null,this.cropper&&(this.cropper.destroy(),this.cropper=null);const e=this.$refs.pond;e&&e.removeFiles(),this.resetImages(),this.isLoading=!1},async initializeCropper(){if(this.cropper&&(this.cropper.destroy(),this.cropper=null),await(0,i.dY)(),this.$refs.image){const e=this.$refs.image;console.log("Initializing cropper..."),this.cropper=new(T())(e,{aspectRatio:1,viewMode:1,ready:()=>{console.log("Cropper ready!");const t=e.naturalWidth,a=e.naturalHeight,o=Math.max(t,a);this.cropper.setData({width:o,height:o,x:(t-o)/2,y:(a-o)/2})}})}else console.error("Image reference is not set");this.loading=!1},async cropImage(){if(this.cropper){this.isLoading=!0;const e=await this.cropper.getCroppedCanvas();this.croppedImage=e.toDataURL("image/png")}else await this.initializeCropper();if(!this.useAIConvert)return this.editedImage=this.croppedImage,await this.createFramedPhoto(),void(this.loading=!1);const e=await this.resizeImage(this.uploadedImage,4194304);try{await this.createPrompt(e)}catch(t){console.error("Error applying edit:",t)}finally{this.loading=!1}this.isLoading=!1},async resizeImage(e,t){return new Promise(((a,o)=>{const i=new Image;i.src=e,i.onload=async()=>{const o=document.createElement("canvas"),n=o.getContext("2d"),r=i.width/i.height;let s=i.width,l=i.height;if(e.length>t){const a=.9*t,o=Math.sqrt(a/e.length);s=Math.round(i.width*o),l=Math.round(s/r)}o.width=s,o.height=l,n.drawImage(i,0,0,s,l);let d=o.toDataURL("image/jpeg",.92);while(d.length>t&&s>100&&l>100)s=Math.round(.95*s),l=Math.round(s/r),o.width=s,o.height=l,n.drawImage(i,0,0,s,l),d=o.toDataURL("image/jpeg",.92-(d.length-t)/(10*t));a(d)},i.onerror=e=>{o(new Error("Failed to load image: "+e))}}))},async applyYoungerEdit(e){this.loading=!0;var t=e+" The overall appearance should give the impression of a vibrant, youthful look, the person about 18 years old";const a={NODE_ENV:"production",BASE_URL:"/"}.BE_URL_API;try{const e=await z.A.post(`${a}/edit-image`,{prompt:t}),o=await e.data;console.log("Response from API:",o),o&&o.data&&o.data.length>0&&o.data[0].URL?(this.editedImage=o.data[0].URL,await this.createFramedPhoto()):(console.error("Error: No editedImage found in the response."),this.loading=!1)}catch(o){console.error("Error applying edit:",o),this.loading=!1}},async createPrompt(e){this.loading=!0,console.log({NODE_ENV:"production",BASE_URL:"/"});try{const t=await fetch(e).then((e=>e.blob())),a=new File([t],"image.png",{type:"image/png"}),o=await this.toBase64(a),i=await z.A.post(`${{NODE_ENV:"production",BASE_URL:"/"}.BE_URL_API}/analyze-image`,{image:o}),n=await i.data;console.log("Response from API:",i),n.content?await this.applyYoungerEdit(n.content):(console.error("Error: No editedImage found in the response."),this.loading=!1)}catch(t){console.error("Error applying edit:",t),this.loading=!1}},async toBase64(e){return new Promise(((t,a)=>{const o=new FileReader;o.readAsDataURL(e),o.onload=()=>t(o.result.split(",")[1]),o.onerror=e=>a(e)}))},dataURLtoFile(e,t){var a=e.split(","),o=a[0].match(/:(.*?);/)[1],i=atob(a[1]),n=i.length,r=new Uint8Array(n);while(n--)r[n]=i.charCodeAt(n);return new File([r],t,{type:o})},async createFramedPhoto(){const e=new Image;e.crossOrigin="anonymous",this.faceDetected&&this.useAIConvert?e.src=`data:image/png;base64,${this.editedImage}`:e.src=this.editedImage;const t=new Image;t.src=this.frameImageSrc,await Promise.all([new Promise((t=>e.onload=t)),new Promise((e=>t.onload=e))]);const a=document.createElement("canvas"),o=a.getContext("2d");a.width=t.width,a.height=t.height,o.drawImage(e,0,0,a.width,a.height),o.drawImage(t,0,0),this.framedImage=a.toDataURL("image/png"),this.isLoading=!1},downloadFramedImage(){if(this.framedImage){const e=document.createElement("a");e.href=this.framedImage,e.download="framed-image.png",document.body.appendChild(e),e.click(),document.body.removeChild(e)}},resetImages(){this.uploadedImage=null,this.croppedImage=null,this.framedImage=null,this.cropper&&(this.cropper.destroy(),this.cropper=null),this.showFileInput=!0}}},N=a(6262);const X=(0,N.A)(B,[["render",O],["__scopeId","data-v-65c9e75a"]]);var $=X,Q={name:"App",components:{FileUpload:$}};const V=(0,N.A)(Q,[["render",s]]);var Y=V;(0,o.Ef)(Y).mount("#app")},6637:function(e,t,a){e.exports=a.p+"img/frame.5f6de8cd.png"}},t={};function a(o){var i=t[o];if(void 0!==i)return i.exports;var n=t[o]={exports:{}};return e[o].call(n.exports,n,n.exports,a),n.exports}a.m=e,function(){var e=[];a.O=function(t,o,i,n){if(!o){var r=1/0;for(c=0;c<e.length;c++){o=e[c][0],i=e[c][1],n=e[c][2];for(var s=!0,l=0;l<o.length;l++)(!1&n||r>=n)&&Object.keys(a.O).every((function(e){return a.O[e](o[l])}))?o.splice(l--,1):(s=!1,n<r&&(r=n));if(s){e.splice(c--,1);var d=i();void 0!==d&&(t=d)}}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[o,i,n]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var o in t)a.o(t,o)&&!a.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){a.p="/"}(),function(){var e={524:0};a.O.j=function(t){return 0===e[t]};var t=function(t,o){var i,n,r=o[0],s=o[1],l=o[2],d=0;if(r.some((function(t){return 0!==e[t]}))){for(i in s)a.o(s,i)&&(a.m[i]=s[i]);if(l)var c=l(a)}for(t&&t(o);d<r.length;d++)n=r[d],a.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return a.O(c)},o=self["webpackChunkphoto_frame_app"]=self["webpackChunkphoto_frame_app"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=a.O(void 0,[504],(function(){return a(6466)}));o=a.O(o)})();
//# sourceMappingURL=app.576814c7.js.map